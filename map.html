<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Your Map</title>
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }

      .overlay {
          position:fixed;
          background:rgba(255, 255, 255, 0.95);
          border:1px solid #aaa;
          padding:20px;
          z-index:5;
      }

      #search-area {
          right:40px;
          top:40px;
      }


      #listing {
          left:40px;
          bottom:150px;
      }
          #listing li {
              list-style:none;
              border-bottom:1px solid #ccc;
              padding:10px;
              cursor: pointer;
          }
          #listing li:hover {
              background:#006;
              color:#fff;
          }

      button {
          background:#006;
          color:#fff;
          font-weight:bold;
          border:1px solid rgba(0,0,0,.85);
          font-size:14px;
          padding:10px 15px;
          outline:none;
      }
    </style>
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>

    <script src="lib/jquery-1.8.2.min.js"></script>
    <script src="lib/underscore-min.js"></script>
    <script src="lib/backbone-min.js"></script>
    <script src="js/backbone.googlemaps-min.js"></script>
</head>

<body>

    <!-- TEMPLATE: InfoWindow
     ============================== -->
    <script id="infoWindow-template" type="text/html">
        <h2><%=title %></h2>
        <p>Latitude: <%=lat %></p>
        <p>Longitude: <%=lng %></p>
    </script>


    <div id="search-area" class="overlay">
        <button id="allHoles"> All </button>
        <button id="recent"> Recent </button>
        <button id="repair"> Repaired </button>
        <!-- <button id="museums">find museums</button>
        <button id="bars">find bars</button>
        <button id="addBtn">add</button>
        <button id="removeBtn">remove</button> -->
    </div>

    <div id="map_canvas" style="width:100%; height:100%"></div>

    <script type="text/javascript">

    var allHoles = [
        {
            title: "POS",
            lat: 10.4767,
            lng: -61.478
        },
        {
            title: "Sando",
            lat: 10.4967,
            lng: -61.5788
        },
        {
            title: "Central",
            lat: 10.5989,
            lng: -61.4324
        }
    ];

    // ---------- Data ------------
    // var museums = [
    //     {
    //         title: "Walker Art Center",
    //         lat: 44.9796635,
    //         lng: -93.2748776
    //     },
    //     {
    //         title: "Science Museum of Minnesota",
    //         lat: 44.9429618,
    //         lng: -93.0981016
    //     },
    //     {
    //         title: "The Museum of Russian Art",
    //         lat: 44.9036337,
    //         lng: -93.2755413
    //     }
    // ];
    // var bars = [
    //     {
    //         title: "Park Tavern",
    //         lat: 44.9413272,
    //         lng: -93.3705791,
    //     },
    //     {
    //         title: "Chatterbox Pub",
    //         lat: 44.9393882,
    //         lng: -93.2391039
    //     },
    //     {
    //         title: "Acadia Cafe",
    //         lat: 44.9709853,
    //         lng: -93.2470717
    //     }
    // ];

    var App = {};


    App.Location = Backbone.GoogleMaps.Location.extend({
        idAttribute: 'title',
        defaults: {
            lat: 10.5,
            lng: -61
        }
    });

    App.LocationCollection = Backbone.GoogleMaps.LocationCollection.extend({
        model: App.Location
    });

    App.InfoWindow = Backbone.GoogleMaps.InfoWindow.extend({
        template: '#infoWindow-template',

        events: {
            'mouseenter h2': 'logTest'
        },

        logTest: function() {
            console.log('test in InfoWindow');
        }
    });

    App.MarkerView = Backbone.GoogleMaps.MarkerView.extend({
        infoWindow: App.InfoWindow,

        overlayOptions: {
            draggable: true
        },

        initialize: function() {
            _.bindAll(this, 'handleDragEnd');
        },

        mapEvents: {
            'dragend'   : 'handleDragEnd'
        },

        handleDragEnd: function(e) {
            alert('Dropped at: \n Lat: ' + e.latLng.lat() + '\n lng: ' + e.latLng.lng());
        }
    });

    App.MarkerCollectionView = Backbone.GoogleMaps.MarkerCollectionView.extend({
        markerView: App.MarkerView
    });

    App.init = function() {
        this.createMap();

        this.places = new this.LocationCollection(allHoles);

        // Render Markers
        var markerCollectionView = new this.MarkerCollectionView({
            collection: this.places,
            map: this.map
        });
        markerCollectionView.render();

        // Render ListView
        var listView = new App.ListView({
            collection: this.places
        });
        listView.render();
    }

    App.createMap = function() {
        var mapOptions = {
            center: new google.maps.LatLng(10.4768765, -61.365369),
            zoom: 10,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }

        // Instantiate map
        map = new google.maps.Map($('#map_canvas')[0], mapOptions);

		var infowindow = new google.maps.InfoWindow();

		var marker, i;

		for (i = 0; i < holes.length; i++) {
		  marker = new google.maps.Marker({
			position: new google.maps.LatLng(holes[i][1], holes[i][2]),
			map: map
		  });

		google.maps.event.addListener(marker, 'mouseover', (function(marker, i) {
			return function() {
			  infowindow.setContent(holes[i][0]);
			  infowindow.open(map, marker);
			}
		})(marker, i));


		};


	};


    /**
     * List view
    */
    App.ItemView = Backbone.View.extend({
        template: '<%=title %>',
        tagName: 'li',

        events: {
            'mouseenter':   'selectItem',
            'mouseleave':   'deselectItem'
        },

        initialize: function() {
            _.bindAll(this, 'render', 'selectItem', 'deselectItem')

            this.model.on("remove", this.close, this);
        },

        render: function() {
            var html = _.template(this.template, this.model.toJSON());
            this.$el.html(html);

            return this;
        },

        close: function() {
            this.$el.remove();
        },

        selectItem: function() {
            this.model.select();
        },

        deselectItem: function() {
            this.model.deselect();
        }
    });

    App.ListView = Backbone.View.extend({
        tagName: 'ul',
        className: 'overlay',
        id: 'listing',

        initialize: function() {
            _.bindAll(this, "refresh", "addChild");

            this.collection.on("reset", this.refresh, this);
            this.collection.on("add", this.addChild, this);

            this.$el.appendTo('body');
        },

        render: function() {
            this.collection.each(this.addChild);
        },

        addChild: function(childModel) {
            var childView = new App.ItemView({ model: childModel });
            childView.render().$el.appendTo(this.$el);
        },

        refresh: function() {
            this.$el.empty();
            this.render();
        }
    });


    $(document).ready(function() {
        App.init();

        $('#allHoles').click(function() {
            App.places.reset(allHoles);
        });

        $('#recent').click(function() {
            App.places.reset(recent);
        });

        $('#repair').click(function() {
            App.places.reset(repair);
        });

        // ----- app functions -------

        // $('#bars').click(function() {
        //     App.places.reset(bars);
        // });

        // $('#museums').click(function() {
        //     App.places.reset(museums);
        // });

        // $('#addBtn').click(function() {
        //     App.places.add({
        //         title: 'State Capitol Building',
        //         lat: 44.9543075,
        //         lng: -93.102222
        //     });
        // });

        // $('#removeBtn').click(function() {
        //     App.places.remove(App.places.at(0));
        // });
    });


    </script>
</body>

</html>